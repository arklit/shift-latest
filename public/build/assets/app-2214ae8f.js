var Ie=Object.defineProperty;var Re=(a,t,i)=>t in a?Ie(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var dt=(a,t,i)=>(Re(a,typeof t!="symbol"?t+"":t,i),i);import{c as qe,g as ze}from"./_commonjsHelpers-725317a4.js";function Pe(a){let t=a.querySelector('button[type="submit"]');const i=new FormData(a),e=new XMLHttpRequest;Xe(a,i),e.open("POST","/orchid/send-modal"),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&e.status===200){const n=JSON.parse(e.responseText);if(n.success)Ye(a);else{const o=n.errors,r=document.createElement("div"),s=document.createElement("p"),d=document.createElement("ul");He(r,s,d),Object.values(o).forEach(function(l,c){We(d,l);let u=a.querySelector(`[name="item[${Object.keys(o)[c]}]"]`);k(u,!1)});const h=document.querySelector(".modal-header");h.parentNode.insertBefore(r,h.nextSibling),Fe(a,o),le(t,!1)}}},e.send(i)}function He(a,t,i){a.classList="error-block alert alert-danger rounded shadow-sm mb-3 p-4",t.insertAdjacentHTML("afterbegin","<strong>О нет! </strong> Измените пару вещей и повторите попытку."),a.appendChild(t),a.appendChild(i)}function We(a,t){const i=document.createElement("li");i.insertAdjacentHTML("afterbegin",t),a.appendChild(i)}function Xe(a,t){const n=a.querySelector(".modal-body").firstElementChild.getAttribute("id");t.append("item[modal_id]",n)}function Ye(a){const t=a.querySelectorAll("input[required], textarea[required], select[required]");let i=!1;if(t.forEach(e=>{e.value.trim()===""&&(i=!0)}),i)t[0].focus();else{const e=a.querySelector(".error-block");e&&e.remove(),a.submit()}}function Fe(a,t){const i=Object.keys(t);if(i.length>0){const e=i[0],n=a.querySelector(`[name="item[${e}]"]`),o=n.offsetTop-100,r=a.closest(".modal");r.scrollTo({top:o,behavior:"smooth"}),r.addEventListener("scroll",function s(){r.scrollTop===o&&(n.focus(),r.removeEventListener("scroll",s))})}}function Wt(a,t){a.querySelectorAll("*").forEach(function(e){e.style.opacity=t})}function le(a,t){const i='<span class="spinner-loading position-absolute top-50 start-50 translate-middle"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></span>';t?(Wt(a,"0"),a.classList="btn btn-default cursor-wait btn-loading",a.disabled=!0,a.insertAdjacentHTML("beforeend",i)):(a.querySelector(".spinner-loading").remove(),a.classList="btn btn-default",Wt(a,"1"),a.disabled=!1)}function je(a,t){a.addEventListener("click",i=>{i.preventDefault();const e=document.querySelector(".error-block");e&&e.remove(),le(a,!0),Pe(t)})}function Xt(a){k(a,a.value.trim()!=="")}function Yt(a){const t=a.tomselect;k(a.nextElementSibling,t.isValid===!0),t.on("change",function(){k(a.nextElementSibling,t.isValid===!0)})}function Ft(a){const t=a.closest(".cropper-parent"),i=t.querySelector(".cropper-actions"),e=t.querySelector("img"),n=e.getAttribute("src");n===""||n==="#"?(i.classList.remove("border-dashed"),k(i,!1)):(i.classList.remove("border-dashed"),k(i,!0)),new MutationObserver(r=>{for(const s of r)if(s.type==="attributes"&&s.attributeName==="src"){const d=e.getAttribute("src");d===""||d==="#"?k(i,!1):k(i,!0)}}).observe(e,{attributes:!0})}function Ue(){document.querySelectorAll('.dropzone-wrapper[data-required="required"]').forEach(function(t){const i=Dropzone.forElement(t);if(i){const e=t.querySelector(".uploader-field"),n=t.querySelector(".uploader-data");k(e,i.files.length!==0),tt(i,n),i.on("addedfile",function(){k(e,i.files.length!==0),tt(i,n)}),i.on("removedfile",function(){k(e,i.files.length!==0),tt(i,n)})}})}function Ve(){document.querySelectorAll('.dropzone-wrapper[data-required="required"]').forEach(function(t){const i=Dropzone.forElement(t);if(i){const e=t.querySelector(".uploader-data");tt(i,e),i.on("addedfile",function(){tt(i,e)}),i.on("removedfile",function(){tt(i,e)})}})}function tt(a,t){t&&(t.value=a.files.length===0?"":a.files.length)}function $e(a){const t=tinymce.get(a.id),e=a.closest('[data-controller="tinymce"]').querySelector(".tox-tinymce");k(e,t.getContent({format:"text"}).trim()!=="");function n(){a.value=t.getContent(),k(e,t.getContent({format:"text"}).trim()!=="")}t.on("keyup",n),t.on("change",n)}function Ge(){document.querySelectorAll('.tinymce[required="required"]').forEach(t=>ce(t))}he();document.addEventListener("turbo:load",he);function jt(a,t,i){a.addEventListener(i,()=>{t.querySelectorAll("input[required], textarea[required], select[required]").forEach(n=>{ce(n)}),Ue()})}function ce(a){a.classList.contains("cropper-path")?(Ft(a),a.addEventListener("change",()=>Ft(a))):a.classList.contains("tinymce")?$e(a):a.tagName.toLowerCase()==="select"?(Yt(a),a.addEventListener("change",()=>Yt(a))):(Xt(a),a.addEventListener("input",()=>Xt(a)))}function k(a,t){const i=a.classList,e="validation-success",n="validation-error";t?(i.remove(n),i.add(e)):(i.remove(e),i.add(n))}function he(){let a=document.getElementById("post-form"),t=document.querySelectorAll(".modal-content");Ge(),jt(a,a,"submit"),t.forEach(i=>{let e=i.querySelector('button[type="submit"]');e&&(jt(e,i,"click"),je(e,i))}),setTimeout(()=>{Ve()},300)}fe();document.addEventListener("turbo:load",fe);function de(a){a.style.display="block";let t=a.parentElement.closest(".list");if(t){let i=t.parentElement.dataset.branch;a.dataset.branch.startsWith(i)&&de(t.parentElement)}}function ue(a){a.style.display="block",a.querySelectorAll(".list > li").forEach(function(i){let e=i.dataset.branch,n=a.dataset.branch;e.startsWith(n)&&ue(i)})}function Ke(a){let t=document.querySelectorAll(".main-list li");t.forEach(function(i){i.style.display="none"}),t.forEach(function(i){i.querySelector(".label .page-name").textContent.toLowerCase().includes(a.toLowerCase())&&(de(i),ue(i),pe())})}function Ze(){document.querySelectorAll(".closed-img").forEach(function(a){a.addEventListener("click",function(t){let i=this.parentNode,e=i.parentNode,n=i.nextElementSibling;e.classList.contains("is-open")?(n.style.display="none",e.classList.remove("is-open"),i.querySelector(".closed-img").classList.remove("open")):(n.style.display="block",e.classList.add("is-open"),i.querySelector(".closed-img").classList.add("open"))})})}function Qe(){document.querySelectorAll(".list").forEach(function(a){a.parentNode.classList.remove("is-open"),a.style.display="none"}),document.querySelectorAll(".has-children").forEach(function(a){a.classList.remove("is-open")}),document.querySelectorAll(".closed-img").forEach(function(a){a.classList.remove("open")})}function pe(){document.querySelectorAll(".parent > .list").forEach(function(t){t.style.display="block"}),document.querySelectorAll(".has-children").forEach(function(t){t.classList.add("is-open")}),document.querySelectorAll(".closed-img").forEach(function(t){t.classList.add("open")})}function Je(a,t){let i;return function(...e){clearTimeout(i),i=setTimeout(()=>a.apply(this,e),t)}}function fe(){setTimeout(()=>{let a=document.getElementById("search-tree");a&&(Ze(),document.querySelector(".uncollapse-all").addEventListener("click",pe),document.querySelector(".collapse-all").addEventListener("click",Qe),a.addEventListener("input",Je(function(){let t=a.value;Ke(t)},200)))},300)}function me(){let a=document.querySelector(".command-bar"),t;setTimeout(()=>{const o=document.querySelector(".mobile-commandbar");o&&o.remove()},300);const i=()=>{t=document.createElement("div"),t.classList.add("mobile-commandbar","show");const o=document.querySelector(".commandbar-layout");if(o){const d=o.cloneNode(!0);t.append(d)}const r=document.querySelector("#post-form");if(r){const d=r.offsetWidth;t.style.width=`${d}px`}function s(){if(t&&document.querySelector(".admin-background")){let h=r.getBoundingClientRect();t.style.left=h.left+"px"}}window.addEventListener("resize",function(){s()}),s(),document.body.appendChild(t),t.style.opacity="0",t.style.transition="opacity 0.5s, transform 0.5s",t.style.position="fixed",t.style.top="-400px",t.style.transform="translateY(-400px)",setTimeout(()=>{t.style.top="0px",t.style.opacity="1",t.style.transform="translateY(0px)"},300)},e=()=>{t&&(t.style.opacity="0",t.style.transform="translateY(-100px)",setTimeout(()=>{t.remove(),t=null},500))};new IntersectionObserver(o=>{o.forEach(r=>{r.isIntersecting?e():t||i()})}).observe(a)}document.addEventListener("turbo:load",()=>{me()});me();function ti(a,t){console.log("Обновленные превью:"),a.querySelectorAll("[data-file-id]").forEach((e,n)=>{t.querySelectorAll('input[type="hidden"][class*="files-"]').forEach((r,s)=>{n===s&&(r.value=e.dataset.fileId,r.classList.remove([...r.classList].filter(d=>d.startsWith("files-"))[0]),r.classList.add(`files-${e.dataset.fileId}`))})})}function ei(a){a.forEach(t=>{let i=t.querySelector(".dropzone-previews");i&&new MutationObserver(()=>{ti(i,t)}).observe(i,{childList:!0})})}function ii(a){for(const t of a)if(t.type==="childList"){const i=document.querySelectorAll('[data-controller="upload"]');if(i.length>0){ei(i),At.disconnect();break}}}const At=new MutationObserver(ii);document.addEventListener("turbo:load",()=>{At.observe(document.documentElement,{childList:!0,subtree:!0})});document.addEventListener("DOMContentLoaded",()=>{At.observe(document.documentElement,{childList:!0,subtree:!0})});/*!
 * Cropper.js v1.6.1
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-09-17T03:44:19.860Z
 */function Ut(a,t){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(a);t&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),i.push.apply(i,e)}return i}function ge(a){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Ut(Object(i),!0).forEach(function(e){ri(a,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):Ut(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})}return a}function wt(a){"@babel/helpers - typeof";return wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wt(a)}function ai(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Vt(a,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,ye(e.key),e)}}function oi(a,t,i){return t&&Vt(a.prototype,t),i&&Vt(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function ri(a,t,i){return t=ye(t),t in a?Object.defineProperty(a,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[t]=i,a}function ve(a){return ni(a)||si(a)||li(a)||ci()}function ni(a){if(Array.isArray(a))return xt(a)}function si(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function li(a,t){if(a){if(typeof a=="string")return xt(a,t);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return xt(a,t)}}function xt(a,t){(t==null||t>a.length)&&(t=a.length);for(var i=0,e=new Array(t);i<t;i++)e[i]=a[i];return e}function ci(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hi(a,t){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var e=i.call(a,t||"default");if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(a)}function ye(a){var t=hi(a,"string");return typeof t=="symbol"?t:String(t)}var mt=typeof window<"u"&&typeof window.document<"u",z=mt?window:{},kt=mt&&z.document.documentElement?"ontouchstart"in z.document.documentElement:!1,Nt=mt?"PointerEvent"in z:!1,w="cropper",_t="all",be="crop",we="move",xe="zoom",$="e",G="w",Z="s",X="n",at="ne",ot="nw",rt="se",nt="sw",Et="".concat(w,"-crop"),$t="".concat(w,"-disabled"),B="".concat(w,"-hidden"),Gt="".concat(w,"-hide"),di="".concat(w,"-invisible"),ft="".concat(w,"-modal"),Ct="".concat(w,"-move"),lt="".concat(w,"Action"),ut="".concat(w,"Preview"),It="crop",Ee="move",Ce="none",Dt="crop",Mt="cropend",St="cropmove",Lt="cropstart",Kt="dblclick",ui=kt?"touchstart":"mousedown",pi=kt?"touchmove":"mousemove",fi=kt?"touchend touchcancel":"mouseup",Zt=Nt?"pointerdown":ui,Qt=Nt?"pointermove":pi,Jt=Nt?"pointerup pointercancel":fi,te="ready",ee="resize",ie="wheel",Tt="zoom",ae="image/jpeg",mi=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,gi=/^data:/,vi=/^data:image\/jpeg;base64,/,yi=/^img|canvas$/i,De=200,Me=100,oe={viewMode:0,dragMode:It,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:De,minContainerHeight:Me,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},bi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',wi=Number.isNaN||z.isNaN;function f(a){return typeof a=="number"&&!wi(a)}var re=function(t){return t>0&&t<1/0};function yt(a){return typeof a>"u"}function K(a){return wt(a)==="object"&&a!==null}var xi=Object.prototype.hasOwnProperty;function Q(a){if(!K(a))return!1;try{var t=a.constructor,i=t.prototype;return t&&i&&xi.call(i,"isPrototypeOf")}catch{return!1}}function O(a){return typeof a=="function"}var Ei=Array.prototype.slice;function Se(a){return Array.from?Array.from(a):Ei.call(a)}function C(a,t){return a&&O(t)&&(Array.isArray(a)||f(a.length)?Se(a).forEach(function(i,e){t.call(a,i,e,a)}):K(a)&&Object.keys(a).forEach(function(i){t.call(a,a[i],i,a)})),a}var x=Object.assign||function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];return K(t)&&e.length>0&&e.forEach(function(o){K(o)&&Object.keys(o).forEach(function(r){t[r]=o[r]})}),t},Ci=/\.\d*(?:0|9){12}\d*$/;function et(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Ci.test(a)?Math.round(a*t)/t:a}var Di=/^width|height|left|top|marginLeft|marginTop$/;function Y(a,t){var i=a.style;C(t,function(e,n){Di.test(n)&&f(e)&&(e="".concat(e,"px")),i[n]=e})}function Mi(a,t){return a.classList?a.classList.contains(t):a.className.indexOf(t)>-1}function L(a,t){if(t){if(f(a.length)){C(a,function(e){L(e,t)});return}if(a.classList){a.classList.add(t);return}var i=a.className.trim();i?i.indexOf(t)<0&&(a.className="".concat(i," ").concat(t)):a.className=t}}function q(a,t){if(t){if(f(a.length)){C(a,function(i){q(i,t)});return}if(a.classList){a.classList.remove(t);return}a.className.indexOf(t)>=0&&(a.className=a.className.replace(t,""))}}function J(a,t,i){if(t){if(f(a.length)){C(a,function(e){J(e,t,i)});return}i?L(a,t):q(a,t)}}var Si=/([a-z\d])([A-Z])/g;function Rt(a){return a.replace(Si,"$1-$2").toLowerCase()}function Ot(a,t){return K(a[t])?a[t]:a.dataset?a.dataset[t]:a.getAttribute("data-".concat(Rt(t)))}function ct(a,t,i){K(i)?a[t]=i:a.dataset?a.dataset[t]=i:a.setAttribute("data-".concat(Rt(t)),i)}function Li(a,t){if(K(a[t]))try{delete a[t]}catch{a[t]=void 0}else if(a.dataset)try{delete a.dataset[t]}catch{a.dataset[t]=void 0}else a.removeAttribute("data-".concat(Rt(t)))}var Le=/\s\s*/,Te=function(){var a=!1;if(mt){var t=!1,i=function(){},e=Object.defineProperty({},"once",{get:function(){return a=!0,t},set:function(o){t=o}});z.addEventListener("test",i,e),z.removeEventListener("test",i,e)}return a}();function I(a,t,i){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=i;t.trim().split(Le).forEach(function(o){if(!Te){var r=a.listeners;r&&r[o]&&r[o][i]&&(n=r[o][i],delete r[o][i],Object.keys(r[o]).length===0&&delete r[o],Object.keys(r).length===0&&delete a.listeners)}a.removeEventListener(o,n,e)})}function _(a,t,i){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=i;t.trim().split(Le).forEach(function(o){if(e.once&&!Te){var r=a.listeners,s=r===void 0?{}:r;n=function(){delete s[o][i],a.removeEventListener(o,n,e);for(var h=arguments.length,l=new Array(h),c=0;c<h;c++)l[c]=arguments[c];i.apply(a,l)},s[o]||(s[o]={}),s[o][i]&&a.removeEventListener(o,s[o][i],e),s[o][i]=n,a.listeners=s}a.addEventListener(o,n,e)})}function it(a,t,i){var e;return O(Event)&&O(CustomEvent)?e=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(e=document.createEvent("CustomEvent"),e.initCustomEvent(t,!0,!0,i)),a.dispatchEvent(e)}function Oe(a){var t=a.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var bt=z.location,Ti=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ne(a){var t=a.match(Ti);return t!==null&&(t[1]!==bt.protocol||t[2]!==bt.hostname||t[3]!==bt.port)}function se(a){var t="timestamp=".concat(new Date().getTime());return a+(a.indexOf("?")===-1?"?":"&")+t}function st(a){var t=a.rotate,i=a.scaleX,e=a.scaleY,n=a.translateX,o=a.translateY,r=[];f(n)&&n!==0&&r.push("translateX(".concat(n,"px)")),f(o)&&o!==0&&r.push("translateY(".concat(o,"px)")),f(t)&&t!==0&&r.push("rotate(".concat(t,"deg)")),f(i)&&i!==1&&r.push("scaleX(".concat(i,")")),f(e)&&e!==1&&r.push("scaleY(".concat(e,")"));var s=r.length?r.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Oi(a){var t=ge({},a),i=0;return C(a,function(e,n){delete t[n],C(t,function(o){var r=Math.abs(e.startX-o.startX),s=Math.abs(e.startY-o.startY),d=Math.abs(e.endX-o.endX),h=Math.abs(e.endY-o.endY),l=Math.sqrt(r*r+s*s),c=Math.sqrt(d*d+h*h),u=(c-l)/l;Math.abs(u)>Math.abs(i)&&(i=u)})}),i}function pt(a,t){var i=a.pageX,e=a.pageY,n={endX:i,endY:e};return t?n:ge({startX:i,startY:e},n)}function Bi(a){var t=0,i=0,e=0;return C(a,function(n){var o=n.startX,r=n.startY;t+=o,i+=r,e+=1}),t/=e,i/=e,{pageX:t,pageY:i}}function F(a){var t=a.aspectRatio,i=a.height,e=a.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",o=re(e),r=re(i);if(o&&r){var s=i*t;n==="contain"&&s>e||n==="cover"&&s<e?i=e/t:e=i*t}else o?i=e/t:r&&(e=i*t);return{width:e,height:i}}function Ai(a){var t=a.width,i=a.height,e=a.degree;if(e=Math.abs(e)%180,e===90)return{width:i,height:t};var n=e%90*Math.PI/180,o=Math.sin(n),r=Math.cos(n),s=t*r+i*o,d=t*o+i*r;return e>90?{width:d,height:s}:{width:s,height:d}}function ki(a,t,i,e){var n=t.aspectRatio,o=t.naturalWidth,r=t.naturalHeight,s=t.rotate,d=s===void 0?0:s,h=t.scaleX,l=h===void 0?1:h,c=t.scaleY,u=c===void 0?1:c,g=i.aspectRatio,m=i.naturalWidth,b=i.naturalHeight,v=e.fillColor,D=v===void 0?"transparent":v,S=e.imageSmoothingEnabled,E=S===void 0?!0:S,P=e.imageSmoothingQuality,A=P===void 0?"low":P,p=e.maxWidth,y=p===void 0?1/0:p,M=e.maxHeight,N=M===void 0?1/0:M,H=e.minWidth,j=H===void 0?0:H,U=e.minHeight,W=U===void 0?0:U,R=document.createElement("canvas"),T=R.getContext("2d"),V=F({aspectRatio:g,width:y,height:N}),ht=F({aspectRatio:g,width:j,height:W},"cover"),gt=Math.min(V.width,Math.max(ht.width,m)),vt=Math.min(V.height,Math.max(ht.height,b)),qt=F({aspectRatio:n,width:y,height:N}),zt=F({aspectRatio:n,width:j,height:W},"cover"),Pt=Math.min(qt.width,Math.max(zt.width,o)),Ht=Math.min(qt.height,Math.max(zt.height,r)),Ne=[-Pt/2,-Ht/2,Pt,Ht];return R.width=et(gt),R.height=et(vt),T.fillStyle=D,T.fillRect(0,0,gt,vt),T.save(),T.translate(gt/2,vt/2),T.rotate(d*Math.PI/180),T.scale(l,u),T.imageSmoothingEnabled=E,T.imageSmoothingQuality=A,T.drawImage.apply(T,[a].concat(ve(Ne.map(function(_e){return Math.floor(et(_e))})))),T.restore(),R}var Be=String.fromCharCode;function Ni(a,t,i){var e="";i+=t;for(var n=t;n<i;n+=1)e+=Be(a.getUint8(n));return e}var _i=/^data:.*,/;function Ii(a){var t=a.replace(_i,""),i=atob(t),e=new ArrayBuffer(i.length),n=new Uint8Array(e);return C(n,function(o,r){n[r]=i.charCodeAt(r)}),e}function Ri(a,t){for(var i=[],e=8192,n=new Uint8Array(a);n.length>0;)i.push(Be.apply(null,Se(n.subarray(0,e)))),n=n.subarray(e);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}function qi(a){var t=new DataView(a),i;try{var e,n,o;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var r=t.byteLength,s=2;s+1<r;){if(t.getUint8(s)===255&&t.getUint8(s+1)===225){n=s;break}s+=1}if(n){var d=n+4,h=n+10;if(Ni(t,d,4)==="Exif"){var l=t.getUint16(h);if(e=l===18761,(e||l===19789)&&t.getUint16(h+2,e)===42){var c=t.getUint32(h+4,e);c>=8&&(o=h+c)}}}if(o){var u=t.getUint16(o,e),g,m;for(m=0;m<u;m+=1)if(g=o+m*12+2,t.getUint16(g,e)===274){g+=8,i=t.getUint16(g,e),t.setUint16(g,1,e);break}}}catch{i=1}return i}function zi(a){var t=0,i=1,e=1;switch(a){case 2:i=-1;break;case 3:t=-180;break;case 4:e=-1;break;case 5:t=90,e=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:i,scaleY:e}}var Pi={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,i=this.options,e=this.container,n=this.cropper,o=Number(i.minContainerWidth),r=Number(i.minContainerHeight);L(n,B),q(t,B);var s={width:Math.max(e.offsetWidth,o>=0?o:De),height:Math.max(e.offsetHeight,r>=0?r:Me)};this.containerData=s,Y(n,{width:s.width,height:s.height}),L(t,B),q(n,B)},initCanvas:function(){var t=this.containerData,i=this.imageData,e=this.options.viewMode,n=Math.abs(i.rotate)%180===90,o=n?i.naturalHeight:i.naturalWidth,r=n?i.naturalWidth:i.naturalHeight,s=o/r,d=t.width,h=t.height;t.height*s>t.width?e===3?d=t.height*s:h=t.width/s:e===3?h=t.width/s:d=t.height*s;var l={aspectRatio:s,naturalWidth:o,naturalHeight:r,width:d,height:h};this.canvasData=l,this.limited=e===1||e===2,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=x({},l)},limitCanvas:function(t,i){var e=this.options,n=this.containerData,o=this.canvasData,r=this.cropBoxData,s=e.viewMode,d=o.aspectRatio,h=this.cropped&&r;if(t){var l=Number(e.minCanvasWidth)||0,c=Number(e.minCanvasHeight)||0;s>1?(l=Math.max(l,n.width),c=Math.max(c,n.height),s===3&&(c*d>l?l=c*d:c=l/d)):s>0&&(l?l=Math.max(l,h?r.width:0):c?c=Math.max(c,h?r.height:0):h&&(l=r.width,c=r.height,c*d>l?l=c*d:c=l/d));var u=F({aspectRatio:d,width:l,height:c});l=u.width,c=u.height,o.minWidth=l,o.minHeight=c,o.maxWidth=1/0,o.maxHeight=1/0}if(i)if(s>(h?0:1)){var g=n.width-o.width,m=n.height-o.height;o.minLeft=Math.min(0,g),o.minTop=Math.min(0,m),o.maxLeft=Math.max(0,g),o.maxTop=Math.max(0,m),h&&this.limited&&(o.minLeft=Math.min(r.left,r.left+(r.width-o.width)),o.minTop=Math.min(r.top,r.top+(r.height-o.height)),o.maxLeft=r.left,o.maxTop=r.top,s===2&&(o.width>=n.width&&(o.minLeft=Math.min(0,g),o.maxLeft=Math.max(0,g)),o.height>=n.height&&(o.minTop=Math.min(0,m),o.maxTop=Math.max(0,m))))}else o.minLeft=-o.width,o.minTop=-o.height,o.maxLeft=n.width,o.maxTop=n.height},renderCanvas:function(t,i){var e=this.canvasData,n=this.imageData;if(i){var o=Ai({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),r=o.width,s=o.height,d=e.width*(r/e.naturalWidth),h=e.height*(s/e.naturalHeight);e.left-=(d-e.width)/2,e.top-=(h-e.height)/2,e.width=d,e.height=h,e.aspectRatio=r/s,e.naturalWidth=r,e.naturalHeight=s,this.limitCanvas(!0,!1)}(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCanvas(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,Y(this.canvas,x({width:e.width,height:e.height},st({translateX:e.left,translateY:e.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var i=this.canvasData,e=this.imageData,n=e.naturalWidth*(i.width/i.naturalWidth),o=e.naturalHeight*(i.height/i.naturalHeight);x(e,{width:n,height:o,left:(i.width-n)/2,top:(i.height-o)/2}),Y(this.image,x({width:e.width,height:e.height},st(x({translateX:e.left,translateY:e.top},e)))),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvasData,e=t.aspectRatio||t.initialAspectRatio,n=Number(t.autoCropArea)||.8,o={width:i.width,height:i.height};e&&(i.height*e>i.width?o.height=o.width/e:o.width=o.height*e),this.cropBoxData=o,this.limitCropBox(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.width=Math.max(o.minWidth,o.width*n),o.height=Math.max(o.minHeight,o.height*n),o.left=i.left+(i.width-o.width)/2,o.top=i.top+(i.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCropBoxData=x({},o)},limitCropBox:function(t,i){var e=this.options,n=this.containerData,o=this.canvasData,r=this.cropBoxData,s=this.limited,d=e.aspectRatio;if(t){var h=Number(e.minCropBoxWidth)||0,l=Number(e.minCropBoxHeight)||0,c=s?Math.min(n.width,o.width,o.width+o.left,n.width-o.left):n.width,u=s?Math.min(n.height,o.height,o.height+o.top,n.height-o.top):n.height;h=Math.min(h,n.width),l=Math.min(l,n.height),d&&(h&&l?l*d>h?l=h/d:h=l*d:h?l=h/d:l&&(h=l*d),u*d>c?u=c/d:c=u*d),r.minWidth=Math.min(h,c),r.minHeight=Math.min(l,u),r.maxWidth=c,r.maxHeight=u}i&&(s?(r.minLeft=Math.max(0,o.left),r.minTop=Math.max(0,o.top),r.maxLeft=Math.min(n.width,o.left+o.width)-r.width,r.maxTop=Math.min(n.height,o.top+o.height)-r.height):(r.minLeft=0,r.minTop=0,r.maxLeft=n.width-r.width,r.maxTop=n.height-r.height))},renderCropBox:function(){var t=this.options,i=this.containerData,e=this.cropBoxData;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,t.movable&&t.cropBoxMovable&&ct(this.face,lt,e.width>=i.width&&e.height>=i.height?we:_t),Y(this.cropBox,x({width:e.width,height:e.height},st({translateX:e.left,translateY:e.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),it(this.element,Dt,this.getData())}},Hi={initPreview:function(){var t=this.element,i=this.crossOrigin,e=this.options.preview,n=i?this.crossOriginUrl:this.url,o=t.alt||"The image to preview",r=document.createElement("img");if(i&&(r.crossOrigin=i),r.src=n,r.alt=o,this.viewBox.appendChild(r),this.viewBoxImage=r,!!e){var s=e;typeof e=="string"?s=t.ownerDocument.querySelectorAll(e):e.querySelector&&(s=[e]),this.previews=s,C(s,function(d){var h=document.createElement("img");ct(d,ut,{width:d.offsetWidth,height:d.offsetHeight,html:d.innerHTML}),i&&(h.crossOrigin=i),h.src=n,h.alt=o,h.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',d.innerHTML="",d.appendChild(h)})}},resetPreview:function(){C(this.previews,function(t){var i=Ot(t,ut);Y(t,{width:i.width,height:i.height}),t.innerHTML=i.html,Li(t,ut)})},preview:function(){var t=this.imageData,i=this.canvasData,e=this.cropBoxData,n=e.width,o=e.height,r=t.width,s=t.height,d=e.left-i.left-t.left,h=e.top-i.top-t.top;!this.cropped||this.disabled||(Y(this.viewBoxImage,x({width:r,height:s},st(x({translateX:-d,translateY:-h},t)))),C(this.previews,function(l){var c=Ot(l,ut),u=c.width,g=c.height,m=u,b=g,v=1;n&&(v=u/n,b=o*v),o&&b>g&&(v=g/o,m=n*v,b=g),Y(l,{width:m,height:b}),Y(l.getElementsByTagName("img")[0],x({width:r*v,height:s*v},st(x({translateX:-d*v,translateY:-h*v},t))))}))}},Wi={bind:function(){var t=this.element,i=this.options,e=this.cropper;O(i.cropstart)&&_(t,Lt,i.cropstart),O(i.cropmove)&&_(t,St,i.cropmove),O(i.cropend)&&_(t,Mt,i.cropend),O(i.crop)&&_(t,Dt,i.crop),O(i.zoom)&&_(t,Tt,i.zoom),_(e,Zt,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&_(e,ie,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&_(e,Kt,this.onDblclick=this.dblclick.bind(this)),_(t.ownerDocument,Qt,this.onCropMove=this.cropMove.bind(this)),_(t.ownerDocument,Jt,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&_(window,ee,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,i=this.options,e=this.cropper;O(i.cropstart)&&I(t,Lt,i.cropstart),O(i.cropmove)&&I(t,St,i.cropmove),O(i.cropend)&&I(t,Mt,i.cropend),O(i.crop)&&I(t,Dt,i.crop),O(i.zoom)&&I(t,Tt,i.zoom),I(e,Zt,this.onCropStart),i.zoomable&&i.zoomOnWheel&&I(e,ie,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&I(e,Kt,this.onDblclick),I(t.ownerDocument,Qt,this.onCropMove),I(t.ownerDocument,Jt,this.onCropEnd),i.responsive&&I(window,ee,this.onResize)}},Xi={resize:function(){if(!this.disabled){var t=this.options,i=this.container,e=this.containerData,n=i.offsetWidth/e.width,o=i.offsetHeight/e.height,r=Math.abs(n-1)>Math.abs(o-1)?n:o;if(r!==1){var s,d;t.restore&&(s=this.getCanvasData(),d=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(C(s,function(h,l){s[l]=h*r})),this.setCropBoxData(C(d,function(h,l){d[l]=h*r})))}}},dblclick:function(){this.disabled||this.options.dragMode===Ce||this.setDragMode(Mi(this.dragBox,Et)?Ee:It)},wheel:function(t){var i=this,e=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(-n*e,t)))},cropStart:function(t){var i=t.buttons,e=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(f(i)&&i!==1||f(e)&&e!==0||t.ctrlKey))){var n=this.options,o=this.pointers,r;t.changedTouches?C(t.changedTouches,function(s){o[s.identifier]=pt(s)}):o[t.pointerId||0]=pt(t),Object.keys(o).length>1&&n.zoomable&&n.zoomOnTouch?r=xe:r=Ot(t.target,lt),mi.test(r)&&it(this.element,Lt,{originalEvent:t,action:r})!==!1&&(t.preventDefault(),this.action=r,this.cropping=!1,r===be&&(this.cropping=!0,L(this.dragBox,ft)))}},cropMove:function(t){var i=this.action;if(!(this.disabled||!i)){var e=this.pointers;t.preventDefault(),it(this.element,St,{originalEvent:t,action:i})!==!1&&(t.changedTouches?C(t.changedTouches,function(n){x(e[n.identifier]||{},pt(n,!0))}):x(e[t.pointerId||0]||{},pt(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var i=this.action,e=this.pointers;t.changedTouches?C(t.changedTouches,function(n){delete e[n.identifier]}):delete e[t.pointerId||0],i&&(t.preventDefault(),Object.keys(e).length||(this.action=""),this.cropping&&(this.cropping=!1,J(this.dragBox,ft,this.cropped&&this.options.modal)),it(this.element,Mt,{originalEvent:t,action:i}))}}},Yi={change:function(t){var i=this.options,e=this.canvasData,n=this.containerData,o=this.cropBoxData,r=this.pointers,s=this.action,d=i.aspectRatio,h=o.left,l=o.top,c=o.width,u=o.height,g=h+c,m=l+u,b=0,v=0,D=n.width,S=n.height,E=!0,P;!d&&t.shiftKey&&(d=c&&u?c/u:1),this.limited&&(b=o.minLeft,v=o.minTop,D=b+Math.min(n.width,e.width,e.left+e.width),S=v+Math.min(n.height,e.height,e.top+e.height));var A=r[Object.keys(r)[0]],p={x:A.endX-A.startX,y:A.endY-A.startY},y=function(N){switch(N){case $:g+p.x>D&&(p.x=D-g);break;case G:h+p.x<b&&(p.x=b-h);break;case X:l+p.y<v&&(p.y=v-l);break;case Z:m+p.y>S&&(p.y=S-m);break}};switch(s){case _t:h+=p.x,l+=p.y;break;case $:if(p.x>=0&&(g>=D||d&&(l<=v||m>=S))){E=!1;break}y($),c+=p.x,c<0&&(s=G,c=-c,h-=c),d&&(u=c/d,l+=(o.height-u)/2);break;case X:if(p.y<=0&&(l<=v||d&&(h<=b||g>=D))){E=!1;break}y(X),u-=p.y,l+=p.y,u<0&&(s=Z,u=-u,l-=u),d&&(c=u*d,h+=(o.width-c)/2);break;case G:if(p.x<=0&&(h<=b||d&&(l<=v||m>=S))){E=!1;break}y(G),c-=p.x,h+=p.x,c<0&&(s=$,c=-c,h-=c),d&&(u=c/d,l+=(o.height-u)/2);break;case Z:if(p.y>=0&&(m>=S||d&&(h<=b||g>=D))){E=!1;break}y(Z),u+=p.y,u<0&&(s=X,u=-u,l-=u),d&&(c=u*d,h+=(o.width-c)/2);break;case at:if(d){if(p.y<=0&&(l<=v||g>=D)){E=!1;break}y(X),u-=p.y,l+=p.y,c=u*d}else y(X),y($),p.x>=0?g<D?c+=p.x:p.y<=0&&l<=v&&(E=!1):c+=p.x,p.y<=0?l>v&&(u-=p.y,l+=p.y):(u-=p.y,l+=p.y);c<0&&u<0?(s=nt,u=-u,c=-c,l-=u,h-=c):c<0?(s=ot,c=-c,h-=c):u<0&&(s=rt,u=-u,l-=u);break;case ot:if(d){if(p.y<=0&&(l<=v||h<=b)){E=!1;break}y(X),u-=p.y,l+=p.y,c=u*d,h+=o.width-c}else y(X),y(G),p.x<=0?h>b?(c-=p.x,h+=p.x):p.y<=0&&l<=v&&(E=!1):(c-=p.x,h+=p.x),p.y<=0?l>v&&(u-=p.y,l+=p.y):(u-=p.y,l+=p.y);c<0&&u<0?(s=rt,u=-u,c=-c,l-=u,h-=c):c<0?(s=at,c=-c,h-=c):u<0&&(s=nt,u=-u,l-=u);break;case nt:if(d){if(p.x<=0&&(h<=b||m>=S)){E=!1;break}y(G),c-=p.x,h+=p.x,u=c/d}else y(Z),y(G),p.x<=0?h>b?(c-=p.x,h+=p.x):p.y>=0&&m>=S&&(E=!1):(c-=p.x,h+=p.x),p.y>=0?m<S&&(u+=p.y):u+=p.y;c<0&&u<0?(s=at,u=-u,c=-c,l-=u,h-=c):c<0?(s=rt,c=-c,h-=c):u<0&&(s=ot,u=-u,l-=u);break;case rt:if(d){if(p.x>=0&&(g>=D||m>=S)){E=!1;break}y($),c+=p.x,u=c/d}else y(Z),y($),p.x>=0?g<D?c+=p.x:p.y>=0&&m>=S&&(E=!1):c+=p.x,p.y>=0?m<S&&(u+=p.y):u+=p.y;c<0&&u<0?(s=ot,u=-u,c=-c,l-=u,h-=c):c<0?(s=nt,c=-c,h-=c):u<0&&(s=at,u=-u,l-=u);break;case we:this.move(p.x,p.y),E=!1;break;case xe:this.zoom(Oi(r),t),E=!1;break;case be:if(!p.x||!p.y){E=!1;break}P=Oe(this.cropper),h=A.startX-P.left,l=A.startY-P.top,c=o.minWidth,u=o.minHeight,p.x>0?s=p.y>0?rt:at:p.x<0&&(h-=c,s=p.y>0?nt:ot),p.y<0&&(l-=u),this.cropped||(q(this.cropBox,B),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}E&&(o.width=c,o.height=u,o.left=h,o.top=l,this.action=s,this.renderCropBox()),C(r,function(M){M.startX=M.endX,M.startY=M.endY})}},Fi={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&L(this.dragBox,ft),q(this.cropBox,B),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=x({},this.initialImageData),this.canvasData=x({},this.initialCanvasData),this.cropBoxData=x({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(x(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),q(this.dragBox,ft),L(this.cropBox,B)),this},replace:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,C(this.previews,function(e){e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,q(this.cropper,$t)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,L(this.cropper,$t)),this},destroy:function(){var t=this.element;return t[w]?(t[w]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,n=e.left,o=e.top;return this.moveTo(yt(t)?t:n+Number(t),yt(i)?i:o+Number(i))},moveTo:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(f(t)&&(e.left=t,n=!0),f(i)&&(e.top=i,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,i){var e=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(e.width*t/e.naturalWidth,null,i)},zoomTo:function(t,i,e){var n=this.options,o=this.canvasData,r=o.width,s=o.height,d=o.naturalWidth,h=o.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&n.zoomable){var l=d*t,c=h*t;if(it(this.element,Tt,{ratio:t,oldRatio:r/d,originalEvent:e})===!1)return this;if(e){var u=this.pointers,g=Oe(this.cropper),m=u&&Object.keys(u).length?Bi(u):{pageX:e.pageX,pageY:e.pageY};o.left-=(l-r)*((m.pageX-g.left-o.left)/r),o.top-=(c-s)*((m.pageY-g.top-o.top)/s)}else Q(i)&&f(i.x)&&f(i.y)?(o.left-=(l-r)*((i.x-o.left)/r),o.top-=(c-s)*((i.y-o.top)/s)):(o.left-=(l-r)/2,o.top-=(c-s)/2);o.width=l,o.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),f(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var i=this.imageData.scaleY;return this.scale(t,f(i)?i:1)},scaleY:function(t){var i=this.imageData.scaleX;return this.scale(f(i)?i:1,t)},scale:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.imageData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(f(t)&&(e.scaleX=t,n=!0),f(i)&&(e.scaleY=i,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,e=this.imageData,n=this.canvasData,o=this.cropBoxData,r;if(this.ready&&this.cropped){r={x:o.left-n.left,y:o.top-n.top,width:o.width,height:o.height};var s=e.width/e.naturalWidth;if(C(r,function(l,c){r[c]=l/s}),t){var d=Math.round(r.y+r.height),h=Math.round(r.x+r.width);r.x=Math.round(r.x),r.y=Math.round(r.y),r.width=h-r.x,r.height=d-r.y}}else r={x:0,y:0,width:0,height:0};return i.rotatable&&(r.rotate=e.rotate||0),i.scalable&&(r.scaleX=e.scaleX||1,r.scaleY=e.scaleY||1),r},setData:function(t){var i=this.options,e=this.imageData,n=this.canvasData,o={};if(this.ready&&!this.disabled&&Q(t)){var r=!1;i.rotatable&&f(t.rotate)&&t.rotate!==e.rotate&&(e.rotate=t.rotate,r=!0),i.scalable&&(f(t.scaleX)&&t.scaleX!==e.scaleX&&(e.scaleX=t.scaleX,r=!0),f(t.scaleY)&&t.scaleY!==e.scaleY&&(e.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);var s=e.width/e.naturalWidth;f(t.x)&&(o.left=t.x*s+n.left),f(t.y)&&(o.top=t.y*s+n.top),f(t.width)&&(o.width=t.width*s),f(t.height)&&(o.height=t.height*s),this.setCropBoxData(o)}return this},getContainerData:function(){return this.ready?x({},this.containerData):{}},getImageData:function(){return this.sized?x({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,i={};return this.ready&&C(["left","top","width","height","naturalWidth","naturalHeight"],function(e){i[e]=t[e]}),i},setCanvasData:function(t){var i=this.canvasData,e=i.aspectRatio;return this.ready&&!this.disabled&&Q(t)&&(f(t.left)&&(i.left=t.left),f(t.top)&&(i.top=t.top),f(t.width)?(i.width=t.width,i.height=t.width/e):f(t.height)&&(i.height=t.height,i.width=t.height*e),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:t.left,top:t.top,width:t.width,height:t.height}),i||{}},setCropBoxData:function(t){var i=this.cropBoxData,e=this.options.aspectRatio,n,o;return this.ready&&this.cropped&&!this.disabled&&Q(t)&&(f(t.left)&&(i.left=t.left),f(t.top)&&(i.top=t.top),f(t.width)&&t.width!==i.width&&(n=!0,i.width=t.width),f(t.height)&&t.height!==i.height&&(o=!0,i.height=t.height),e&&(n?i.height=i.width/e:o&&(i.width=i.height*e)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,e=ki(this.image,this.imageData,i,t);if(!this.cropped)return e;var n=this.getData(t.rounded),o=n.x,r=n.y,s=n.width,d=n.height,h=e.width/Math.floor(i.naturalWidth);h!==1&&(o*=h,r*=h,s*=h,d*=h);var l=s/d,c=F({aspectRatio:l,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),u=F({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),g=F({aspectRatio:l,width:t.width||(h!==1?e.width:s),height:t.height||(h!==1?e.height:d)}),m=g.width,b=g.height;m=Math.min(c.width,Math.max(u.width,m)),b=Math.min(c.height,Math.max(u.height,b));var v=document.createElement("canvas"),D=v.getContext("2d");v.width=et(m),v.height=et(b),D.fillStyle=t.fillColor||"transparent",D.fillRect(0,0,m,b);var S=t.imageSmoothingEnabled,E=S===void 0?!0:S,P=t.imageSmoothingQuality;D.imageSmoothingEnabled=E,P&&(D.imageSmoothingQuality=P);var A=e.width,p=e.height,y=o,M=r,N,H,j,U,W,R;y<=-s||y>A?(y=0,N=0,j=0,W=0):y<=0?(j=-y,y=0,N=Math.min(A,s+y),W=N):y<=A&&(j=0,N=Math.min(s,A-y),W=N),N<=0||M<=-d||M>p?(M=0,H=0,U=0,R=0):M<=0?(U=-M,M=0,H=Math.min(p,d+M),R=H):M<=p&&(U=0,H=Math.min(d,p-M),R=H);var T=[y,M,N,H];if(W>0&&R>0){var V=m/s;T.push(j*V,U*V,W*V,R*V)}return D.drawImage.apply(D,[e].concat(ve(T.map(function(ht){return Math.floor(et(ht))})))),v},setAspectRatio:function(t){var i=this.options;return!this.disabled&&!yt(t)&&(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var i=this.options,e=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var o=t===It,r=i.movable&&t===Ee;t=o||r?t:Ce,i.dragMode=t,ct(e,lt,t),J(e,Et,o),J(e,Ct,r),i.cropBoxMovable||(ct(n,lt,t),J(n,Et,o),J(n,Ct,r))}return this}},ji=z.Cropper,Ae=function(){function a(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ai(this,a),!t||!yi.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=x({},oe,Q(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return oi(a,[{key:"init",value:function(){var i=this.element,e=i.tagName.toLowerCase(),n;if(!i[w]){if(i[w]=this,e==="img"){if(this.isImg=!0,n=i.getAttribute("src")||"",this.originalUrl=n,!n)return;n=i.src}else e==="canvas"&&window.HTMLCanvasElement&&(n=i.toDataURL());this.load(n)}}},{key:"load",value:function(i){var e=this;if(i){this.url=i,this.imageData={};var n=this.element,o=this.options;if(!o.rotatable&&!o.scalable&&(o.checkOrientation=!1),!o.checkOrientation||!window.ArrayBuffer){this.clone();return}if(gi.test(i)){vi.test(i)?this.read(Ii(i)):this.clone();return}var r=new XMLHttpRequest,s=this.clone.bind(this);this.reloading=!0,this.xhr=r,r.onabort=s,r.onerror=s,r.ontimeout=s,r.onprogress=function(){r.getResponseHeader("content-type")!==ae&&r.abort()},r.onload=function(){e.read(r.response)},r.onloadend=function(){e.reloading=!1,e.xhr=null},o.checkCrossOrigin&&ne(i)&&n.crossOrigin&&(i=se(i)),r.open("GET",i,!0),r.responseType="arraybuffer",r.withCredentials=n.crossOrigin==="use-credentials",r.send()}}},{key:"read",value:function(i){var e=this.options,n=this.imageData,o=qi(i),r=0,s=1,d=1;if(o>1){this.url=Ri(i,ae);var h=zi(o);r=h.rotate,s=h.scaleX,d=h.scaleY}e.rotatable&&(n.rotate=r),e.scalable&&(n.scaleX=s,n.scaleY=d),this.clone()}},{key:"clone",value:function(){var i=this.element,e=this.url,n=i.crossOrigin,o=e;this.options.checkCrossOrigin&&ne(e)&&(n||(n="anonymous"),o=se(e)),this.crossOrigin=n,this.crossOriginUrl=o;var r=document.createElement("img");n&&(r.crossOrigin=n),r.src=o||e,r.alt=i.alt||"The image to crop",this.image=r,r.onload=this.start.bind(this),r.onerror=this.stop.bind(this),L(r,Gt),i.parentNode.insertBefore(r,i.nextSibling)}},{key:"start",value:function(){var i=this,e=this.image;e.onload=null,e.onerror=null,this.sizing=!0;var n=z.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(z.navigator.userAgent),o=function(h,l){x(i.imageData,{naturalWidth:h,naturalHeight:l,aspectRatio:h/l}),i.initialImageData=x({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(e.naturalWidth&&!n){o(e.naturalWidth,e.naturalHeight);return}var r=document.createElement("img"),s=document.body||document.documentElement;this.sizingImage=r,r.onload=function(){o(r.width,r.height),n||s.removeChild(r)},r.src=e.src,n||(r.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(r))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,e=this.options,n=this.image,o=i.parentNode,r=document.createElement("div");r.innerHTML=bi;var s=r.querySelector(".".concat(w,"-container")),d=s.querySelector(".".concat(w,"-canvas")),h=s.querySelector(".".concat(w,"-drag-box")),l=s.querySelector(".".concat(w,"-crop-box")),c=l.querySelector(".".concat(w,"-face"));this.container=o,this.cropper=s,this.canvas=d,this.dragBox=h,this.cropBox=l,this.viewBox=s.querySelector(".".concat(w,"-view-box")),this.face=c,d.appendChild(n),L(i,B),o.insertBefore(s,i.nextSibling),q(n,Gt),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,L(l,B),e.guides||L(l.getElementsByClassName("".concat(w,"-dashed")),B),e.center||L(l.getElementsByClassName("".concat(w,"-center")),B),e.background&&L(s,"".concat(w,"-bg")),e.highlight||L(c,di),e.cropBoxMovable&&(L(c,Ct),ct(c,lt,_t)),e.cropBoxResizable||(L(l.getElementsByClassName("".concat(w,"-line")),B),L(l.getElementsByClassName("".concat(w,"-point")),B)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),O(e.ready)&&_(i,te,e.ready,{once:!0}),it(i,te)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),q(this.element,B)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ji,a}},{key:"setDefaults",value:function(i){x(oe,Q(i)&&i)}}]),a}();x(Ae.prototype,Pi,Hi,Wi,Xi,Yi,Fi);var ke={exports:{}};(function(a,t){(function(i,e){a.exports=e()})(qe,function(){var i=!1;function e(o){this.opts=function(){for(var r=1;r<arguments.length;r++)for(var s in arguments[r])arguments[r].hasOwnProperty(s)&&(arguments[0][s]=arguments[r][s]);return arguments[0]}({},{onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["overlay","button","escape"]},o),this.init()}function n(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}return e.prototype.init=function(){if(!this.modal)return(function(){this.modal=document.createElement("div"),this.modal.classList.add("tingle-modal"),this.opts.closeMethods.length!==0&&this.opts.closeMethods.indexOf("overlay")!==-1||this.modal.classList.add("tingle-modal--noOverlayClose"),this.modal.style.display="none",this.opts.cssClass.forEach(function(o){typeof o=="string"&&this.modal.classList.add(o)},this),this.opts.closeMethods.indexOf("button")!==-1&&(this.modalCloseBtn=document.createElement("button"),this.modalCloseBtn.type="button",this.modalCloseBtn.classList.add("tingle-modal__close"),this.modalCloseBtnIcon=document.createElement("span"),this.modalCloseBtnIcon.classList.add("tingle-modal__closeIcon"),this.modalCloseBtnIcon.innerHTML='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.3 9.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3L5 6.4l3.3 3.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L6.4 5l3.3-3.3c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0L5 3.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L3.6 5 .3 8.3c-.4.4-.4 1 0 1.4z" fill="#000" fill-rule="nonzero"/></svg>',this.modalCloseBtnLabel=document.createElement("span"),this.modalCloseBtnLabel.classList.add("tingle-modal__closeLabel"),this.modalCloseBtnLabel.innerHTML=this.opts.closeLabel,this.modalCloseBtn.appendChild(this.modalCloseBtnIcon),this.modalCloseBtn.appendChild(this.modalCloseBtnLabel)),this.modalBox=document.createElement("div"),this.modalBox.classList.add("tingle-modal-box"),this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("tingle-modal-box__content"),this.modalBox.appendChild(this.modalBoxContent),this.opts.closeMethods.indexOf("button")!==-1&&this.modal.appendChild(this.modalCloseBtn),this.modal.appendChild(this.modalBox)}).call(this),(function(){this._events={clickCloseBtn:this.close.bind(this),clickOverlay:(function(o){var r=this.modal.offsetWidth-this.modal.clientWidth,s=o.clientX>=this.modal.offsetWidth-15,d=this.modal.scrollHeight!==this.modal.offsetHeight;navigator.platform==="MacIntel"&&r==0&&s&&d||this.opts.closeMethods.indexOf("overlay")!==-1&&!function(h,l){for(;(h=h.parentElement)&&!h.classList.contains(l););return h}(o.target,"tingle-modal")&&o.clientX<this.modal.clientWidth&&this.close()}).bind(this),resize:this.checkOverflow.bind(this),keyboardNav:(function(o){this.opts.closeMethods.indexOf("escape")!==-1&&o.which===27&&this.isOpen()&&this.close()}).bind(this)},this.opts.closeMethods.indexOf("button")!==-1&&this.modalCloseBtn.addEventListener("click",this._events.clickCloseBtn),this.modal.addEventListener("mousedown",this._events.clickOverlay),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}).call(this),document.body.appendChild(this.modal,document.body.firstChild),this.opts.footer&&this.addFooter(),this},e.prototype._busy=function(o){i=o},e.prototype._isBusy=function(){return i},e.prototype.destroy=function(){this.modal!==null&&(this.isOpen()&&this.close(!0),(function(){this.opts.closeMethods.indexOf("button")!==-1&&this.modalCloseBtn.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}).call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},e.prototype.isOpen=function(){return!!this.modal.classList.contains("tingle-modal--visible")},e.prototype.open=function(){if(!this._isBusy()){this._busy(!0);var o=this;return typeof o.opts.beforeOpen=="function"&&o.opts.beforeOpen(),this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),document.getSelection().removeAllRanges(),this._scrollPosition=window.pageYOffset,document.body.classList.add("tingle-enabled"),document.body.style.top=-this._scrollPosition+"px",this.setStickyFooter(this.opts.stickyFooter),this.modal.classList.add("tingle-modal--visible"),typeof o.opts.onOpen=="function"&&o.opts.onOpen.call(o),o._busy(!1),this.checkOverflow(),this}},e.prototype.close=function(o){if(!this._isBusy()){if(this._busy(!0),typeof this.opts.beforeClose=="function"&&!this.opts.beforeClose.call(this))return void this._busy(!1);document.body.classList.remove("tingle-enabled"),document.body.style.top=null,window.scrollTo({top:this._scrollPosition,behavior:"instant"}),this.modal.classList.remove("tingle-modal--visible");var r=this;r.modal.style.display="none",typeof r.opts.onClose=="function"&&r.opts.onClose.call(this),r._busy(!1)}},e.prototype.setContent=function(o){return typeof o=="string"?this.modalBoxContent.innerHTML=o:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(o)),this.isOpen()&&this.checkOverflow(),this},e.prototype.getContent=function(){return this.modalBoxContent},e.prototype.addFooter=function(){return(function(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("tingle-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter)}).call(this),this},e.prototype.setFooterContent=function(o){return this.modalBoxFooter.innerHTML=o,this},e.prototype.getFooterContent=function(){return this.modalBoxFooter},e.prototype.setStickyFooter=function(o){return this.isOverflow()||(o=!1),o?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("tingle-modal-box__footer--sticky"),n.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("tingle-modal-box__footer--sticky"))),this},e.prototype.addFooterBtn=function(o,r,s){var d=document.createElement("button");return d.innerHTML=o,d.addEventListener("click",s),typeof r=="string"&&r.length&&r.split(" ").forEach(function(h){d.classList.add(h)}),this.modalBoxFooter.appendChild(d),d},e.prototype.resize=function(){console.warn("Resize is deprecated and will be removed in version 1.0")},e.prototype.isOverflow=function(){return window.innerHeight<=this.modalBox.clientHeight},e.prototype.checkOverflow=function(){this.modal.classList.contains("tingle-modal--visible")&&(this.isOverflow()?this.modal.classList.add("tingle-modal--overflow"):this.modal.classList.remove("tingle-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(n.call(this),this.setStickyFooter(!0)))},{modal:e}})})(ke);var Ui=ke.exports;const Vi=ze(Ui);class Bt extends window.Controller{connect(){let t=this.data.get("url")?this.data.get("url"):this.data.get("value");t?this.element.querySelector(".cropper-preview").src=t:(this.element.querySelector(".cropper-preview").classList.add("none"),this.element.querySelector(".cropper-remove").classList.add("none"))}getModal(){let t=this.data.get("width"),i=this.data.get("height"),e=`<div class="modal-to-clone" role="dialog">
                                <div class="modal-dialog modal-fullscreen-md-down modal-lg">
                                    <div class="modal-content-wrapper">
                                        <div class="modal-content">
                                            <div class="position-relative">
                                                <img class="upload-panel">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;return this.modal=new Vi.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay"],closeLabel:"Close",cssClass:["custom-class-1","custom-class-2"],onOpen:function(){this.setContent(e);let n=document.querySelector(".upload-panel");n.width=t,n.height=i,window.cropper=new Ae(n,{viewMode:2,aspectRatio:t/i,minContainerHeight:500})},onClose:function(){this.destroy()},beforeClose:function(){return!0}}),this.modal.addFooterBtn("Закрыть","btn btn-link",()=>{this.modal.close()}),this.modal.addFooterBtn("Обрезать","btn btn-default",()=>{this.crop(this.modal)}),this.clearEvent(),this.modal}upload(t){let i=this.data.get("max-file-size");if(i!==null&&t.target.files[0].size/1024/1024>i){this.alert("Validation error",`The download file is too large. Max size: ${i} MB`),t.target.value=null;return}this.selected=t.target.closest(".cropper-parent"),this.getModal().open();let e=new FileReader;e.readAsDataURL(t.target.files[0]),e.onloadend=()=>{window.cropper.replace(e.result)},document.querySelector(".cropper-path").dispatchEvent(new Event("change"))}crop(t){window.cropper.getCroppedCanvas({fillColor:"#fff"}).toBlob(i=>{const e=new FormData;e.append("file",i),e.append("storage",this.data.get("storage")),e.append("group",this.data.get("groups")),e.append("path",this.data.get("path")),e.append("acceptedFiles",this.data.get("accepted-files")),e.append("width",this.data.get("width")),e.append("height",this.data.get("height")),window.axios.post(this.prefix("/systems/files"),e).then(n=>{let o=n.data.url,r=this.data.get("target");this.selected.querySelector(".cropper-preview").src=o,this.selected.querySelector(".cropper-preview").classList.remove("none"),this.selected.querySelector(".cropper-remove").classList.remove("none"),this.selected.querySelector(".cropper-path").value=n.data[r],this.selected.querySelector(".cropper-path").dispatchEvent(new Event("change")),t.close(),this.selected=null}).catch(n=>{this.alert("Validation error","File upload error"),console.warn(n)})},"image/jpeg")}clear(t){this.selected=t.target.closest(".cropper-parent"),this.selected&&(this.selected.querySelector(".cropper-path").value="",this.selected.querySelector(".cropper-preview").src="",this.selected.querySelector(".cropper-preview").classList.add("none"),this.selected.querySelector(".cropper-remove").classList.add("none")),this.selected=null}clearEvent(){document.querySelector(".tingle-modal").querySelector(".btn.btn-link").addEventListener("click",e=>{this.clear(e)}),window.addEventListener("click",e=>{e.target.closest(".tingle-modal")||this.clear(e)})}moveleft(){this.cropper.move(-10,0)}moveright(){this.cropper.move(10,0)}moveup(){this.cropper.move(0,-10)}movedown(){this.cropper.move(0,10)}zoomin(){this.cropper.zoom(.1)}zoomout(){this.cropper.zoom(-.1)}rotateleft(){this.cropper.rotate(-5)}rotateright(){this.cropper.rotate(5)}scalex(){const t=this.element.querySelector(".cropper-dataScaleX");this.cropper.scaleX(-t.value)}scaley(){const t=this.element.querySelector(".cropper-dataScaleY");this.cropper.scaleY(-t.value)}aspectratiowh(){this.cropper.setAspectRatio(this.data.get("width")/this.data.get("height"))}aspectratiofree(){this.cropper.setAspectRatio(NaN)}}dt(Bt,"selected",null),dt(Bt,"targets",["source","upload"]);class $i extends window.Controller{constructor(){super(...arguments);dt(this,"example_image_upload_handler",(i,e)=>new Promise((n,o)=>{const r=new XMLHttpRequest;let s=function(l){let u=`${document.head.querySelector('meta[name="dashboard-prefix"]').content}${l}`.replace(/\/\/+/g,"/");return`${location.protocol}//${location.hostname}${location.port?`:${location.port}`:""}${u}`},d=document.head.querySelector('meta[name="csrf_token"]').getAttribute("content");r.withCredentials=!1,r.open("POST",s("/systems/files")),r.upload.onprogress=l=>{e(l.loaded/l.total*100)},r.onload=()=>{if(r.status===403){o({message:"HTTP Error: "+r.status,remove:!0});return}if(r.status<200||r.status>=300){o("HTTP Error: "+r.status);return}const l=JSON.parse(r.responseText);if(l.location=l.relativeUrl,!l||typeof l.location!="string"){o("Invalid JSON: "+r.responseText);return}n(l.location)},r.onerror=()=>{o("Image upload failed due to a XHR Transport error. Code: "+r.status)};const h=new FormData;h.append("_token",d),h.append("file",i.blob(),i.filename()),r.send(h)}))}connect(){const i="#"+this.element.querySelector(".tinymce").id;tinymce.remove(i),tinymce.init({selector:i,language:this.element.dataset.language,plugins:"preview importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount help charmap quickbars emoticons",toolbar:"undo redo bold italic underline strikethrough fontfamily fontsize blocks alignleft aligncenter alignright alignjustify outdent indent  numlist bullist forecolor backcolor removeformat pagebreak charmap emoticons fullscreen code preview print insertfile image media link anchor codesample ltr rtl",menubar:!1,table_header_type:"section",images_upload_handler:this.example_image_upload_handler})}disconnect(i){tinymce.remove(i)}}application.register("cropperrocont",Bt);application.register("tinymce",$i);
